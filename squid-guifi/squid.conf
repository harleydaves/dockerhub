dns_v4_first on 

cache deny all
cachemgr_passwd guifilan all

access_log /var/log/squid/access.log combined

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
#acl localnet src 10.0.0.0/8    # RFC1918 possible internal network
#acl localnet src 172.16.0.0/12 # RFC1918 possible internal network
#acl localnet src 192.168.0.0/16        # RFC1918 possible internal network
#acl localnet src fc00::/7       # RFC 4193 local private network range
#acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

acl localnet dst 10.0.0.0/8
acl to_privatenet dst 192.168.0.0/16 
#acl to_localhost dst 127.0.0.0/8

acl SSL_ports port 443
acl SSL_ports port 7018
acl Safe_ports port 80          # http
acl Safe_ports port 443         # https
acl Safe_ports port 7017
acl Safe_ports port 7018
#acl Safe_ports port 21         # ftp
#acl Safe_ports port 70         # gopher
#acl Safe_ports port 210                # wais
#acl Safe_ports port 1025-65535 # unregistered ports
#acl Safe_ports port 280                # http-mgmt
#acl Safe_ports port 488                # gss-http
#acl Safe_ports port 591                # filemaker
#acl Safe_ports port 777                # multiling http
acl CONNECT method CONNECT

#acl GUIFI src 10.0.0.0/8 
#acl limitusercon maxconn 32
#http_access deny GUIFI limitusercon

# Autenticacio
#auth_param basic program /usr/lib/squid/basic_ldap_auth -b "o=proxyusers,dc=guifi,dc=net" -f "uid=%s" -H ldaps://ldap.guifi.net
#acl ldapauth proxy_auth REQUIRED


#acl blockeddomain dstdomain "/etc/squid/blocked.domains.acl"
#http_access deny blockeddomain

#acl ggcache url_regex -i ^https://www.google.[a-z]+/search\?.*$
#http_access deny ggcache

acl https port 443 
acl google dstdomain google.es
acl googlecom dstdomain google.com
http_access deny https google 
http_access deny https googlecom

auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/guifinet_passwd
auth_param basic children 5
auth_param basic realm Guifi.net proxy-caching web server
auth_param basic credentialsttl 2 hours
auth_param basic casesensitive off

acl ncsa_users proxy_auth REQUIRED


#
# Recommended minimum Access Permission configuration:
#
# Only allow cachemgr access from localhost
#http_access allow localhost manager
#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

http_access allow localhost manager

http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports


http_access deny to_privatenet
http_access deny to_localhost





#external_acl_type session concurrency=100 ttl=10 %SRC /usr/lib/squid/ext_session_acl -a -T 7200 -b /var/cache/squid/session/
#acl session_login external session LOGIN
#external_acl_type session_active_def concurrency=100 ttl=10 %SRC /usr/lib/squid/ext_session_acl -a -T 7200 -b /var/cache/squid/session/
#acl session_is_active external session_active_def
#acl clicked_login_url url_regex -i http://10.228.144.163/goo.html
#http_access allow clicked_login_url session_login
#http_access allow localnet
#http_access deny !session_is_active
#deny_info http://10.228.144.163/proxy.html session_is_active

# And finally deny all other access to this proxy
#http_access allow ldapauth

# If we get here, URL not present, so renew session or deny request.

http_access allow ncsa_users
http_access deny all

# Squid normally listens to port 3128
http_port 3128

# Delay pools 5Mbits
#delay_pools    1
#delay_class    1 2
#delay_parameters 1 524288/524288 262144/262144
#delay_access 1 allow ncsa_users

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/cache/squid 256 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/cache/squid

# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320


#url_rewrite_program /usr/sbin/squidGuard -c /etc/squid/squidGuard.conf
#redirect_children 4
